pipeline {
  agent any
  stages {
    stage('Clone') {
      steps {
        git branch: 'main', url: 'https://github.com/Prabhupadige03/eCommerce-Shop.git'
      }
    }
    stage('Install') {
      steps {
        sh 'npm install'
      }
    }
    stage('Deploy') {
      steps {
        sh 'scp -o StrictHostKeyChecking=no -r * ubuntu@16.171.238.77:/home/ubuntu/shopping/'
        sh ''' ssh ubuntu@16.171.238.77 "cd /home/ubuntu/shopping && npm install && pm2 stop shopping || true && pm2 start server.js --name shopping"'''
      }
    }
  }
}
